<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>内存空间 | Li_技术笔记</title>
    <meta name="description" content="随手笔记，记录生活，记录成长">
    
    
    <link rel="preload" href="/myBlog/assets/css/0.styles.fb612739.css" as="style"><link rel="preload" href="/myBlog/assets/js/app.fe4596cb.js" as="script"><link rel="preload" href="/myBlog/assets/js/2.69ff1a9d.js" as="script"><link rel="preload" href="/myBlog/assets/js/3.d6642b46.js" as="script"><link rel="prefetch" href="/myBlog/assets/js/10.93ff5851.js"><link rel="prefetch" href="/myBlog/assets/js/11.60d04a51.js"><link rel="prefetch" href="/myBlog/assets/js/12.9cd81675.js"><link rel="prefetch" href="/myBlog/assets/js/13.c8281004.js"><link rel="prefetch" href="/myBlog/assets/js/14.1e996fa9.js"><link rel="prefetch" href="/myBlog/assets/js/15.7d5dc05e.js"><link rel="prefetch" href="/myBlog/assets/js/16.35a5e756.js"><link rel="prefetch" href="/myBlog/assets/js/17.e0b15ed9.js"><link rel="prefetch" href="/myBlog/assets/js/18.ec82d801.js"><link rel="prefetch" href="/myBlog/assets/js/19.17d9c18c.js"><link rel="prefetch" href="/myBlog/assets/js/20.32fe3555.js"><link rel="prefetch" href="/myBlog/assets/js/21.65905fe2.js"><link rel="prefetch" href="/myBlog/assets/js/4.445f3cb0.js"><link rel="prefetch" href="/myBlog/assets/js/5.e87337b6.js"><link rel="prefetch" href="/myBlog/assets/js/6.a77e9eab.js"><link rel="prefetch" href="/myBlog/assets/js/7.39543e83.js"><link rel="prefetch" href="/myBlog/assets/js/8.c052c0db.js"><link rel="prefetch" href="/myBlog/assets/js/9.291dbf39.js">
    <link rel="stylesheet" href="/myBlog/assets/css/0.styles.fb612739.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myBlog/" class="home-link router-link-active"><!----> <span class="site-name">Li_技术笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myBlog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/myBlog/technical/" class="nav-link router-link-active">技术笔记</a></div><div class="nav-item"><a href="/myBlog/article/" class="nav-link">个人文章</a></div><div class="nav-item"><a href="/myBlog/hobby/" class="nav-link">好文收藏</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/myBlog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/myBlog/technical/" class="nav-link router-link-active">技术笔记</a></div><div class="nav-item"><a href="/myBlog/article/" class="nav-link">个人文章</a></div><div class="nav-item"><a href="/myBlog/hobby/" class="nav-link">好文收藏</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myBlog/technical/base/base7.html" class="sidebar-link">数组</a></li><li><a href="/myBlog/technical/base/base6.html" class="sidebar-link">ES6语法</a></li><li><a href="/myBlog/technical/base/base1.html" class="active sidebar-link">内存空间</a></li><li><a href="/myBlog/technical/base/base2.html" class="sidebar-link">作用域闭包</a></li><li><a href="/myBlog/technical/base/base3.html" class="sidebar-link">this解析</a></li><li><a href="/myBlog/technical/base/base4.html" class="sidebar-link">原型prototype</a></li><li><a href="/myBlog/technical/base/base5.html" class="sidebar-link">高级函数</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进阶篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node篇</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="内存空间"><a href="#内存空间" class="header-anchor">#</a> 内存空间</h1> <h4 id="一、栈数据结构"><a href="#一、栈数据结构" class="header-anchor">#</a> 一、栈数据结构</h4> <p>与c/c++不同，JavaScript中并没有严格意义上区分栈内存与堆内存。因此我们就可以简单除暴的理解为JavaScript的所有数据都保存在堆内存中。但是在某些场景，我们仍然需要基于堆栈数据结构的思维来实现一些功能，比如JavaScript的执行上下文。执行上下文的执行顺序借用了栈数据结构的存取方式（函数调用栈）。因此理解栈数据结构的原理与特点十分重要。</p> <p>要简单理解栈的存取方式，我们可以通过类比乒乓球盒子来分析。
<img src="/myBlog/assets/img/p1-1.98c4d2fa.png" alt="p1"></p> <p>这种乒乓球的存放方式与栈中存取数据的方式如出一辙。处于盒子中最顶层的乒乓球5，它一定是最后放进去，但可以最先被使用。而我们想要使用底层的乒乓球1，就必须将上面的4个乒乓球取出来，让乒乓球1处于盒子顶层。这就是栈空间<strong>先进后出，后进先出</strong>的特点 。图中已经详细的表明了栈空间的存储原理。</p> <h4 id="二、堆数据结构"><a href="#二、堆数据结构" class="header-anchor">#</a> 二、堆数据结构</h4> <p>堆数据结构是一种树状结构。它的存取数据的方式，则与书架和书非常相似。</p> <p>书虽然也整齐的存放在书架上，但是我们只要知道书的名字，我们就可以很方便的取出我们想要的书，而不用想从乒乓球盒子里取乒乓球一样，非得将上面的所有乒乓球拿出来才能取到中间的某一个乒乓球。好比在JSON格式的数据中，我们存储的<code>key-value</code>是可以无序的，因此顺序的不同并不影响我们的使用，我们只需要关心书的名字。</p> <h4 id="三、队列"><a href="#三、队列" class="header-anchor">#</a> 三、队列</h4> <p>在JavaScript中，理解队列数据结构的目的主要是清晰的明白事件循环（Event loop）的机制到底是怎么回事。</p> <p>队列是中**先进先出（FIFO）**的数据结构。正如排队安检一样，排在队伍前面的人一定是最先过安检的人。用一下的图示可以清楚的理解队列的原理。</p> <p><img src="/myBlog/assets/img/p1-2.c724b3b3.png" alt="p2"></p> <h4 id="四、变量对象与基础数据类型"><a href="#四、变量对象与基础数据类型" class="header-anchor">#</a> 四、变量对象与基础数据类型</h4> <p>JavaScript的执行上下文生成之后，会创建一个叫做变量对象的特殊对象，JavaScript的基础数据类型往往都会保存在变量对象中。</p> <blockquote><p>严格意义上来说，变量对象也是存放于堆内存中，但是由于变量对象的特殊职能，我们在理解时仍然需要将其堆内存区分开来</p></blockquote> <p>基础数据类型都是一些简单的数据段，JavaScript中有5种基础数据类型，分别是<code>Undefined Null Boolean Number String</code>。基础数据类型都是按值访问，因为我们可以直接操作保存在变量中的实际的值。</p> <blockquote><p>ES6中新加入了一种基础数据类型Symbol，可以先不用考虑它</p></blockquote> <h4 id="五、引用数据类型与堆内存"><a href="#五、引用数据类型与堆内存" class="header-anchor">#</a> 五、引用数据类型与堆内存</h4> <p>与其他语言不同，JS的引用数据类型，比如数组Array，它们值的大小是不固定的。引用数据类型的值是保存在堆内存中的对象。JavaScript不允许直接访问堆内存中的位置，因此我们不能直接操作对象的堆内存空间。在操作对象时，实际上是在对操作对象的引用而不是实际的对象。因此，引用类型的值都是按引用访问的。这里的引用，我们可以理解为保存在变量中的一个地址，该地址与堆内存的实际值相关联。</p> <p>为了更好的搞懂变量对象与堆内存，我们可以结合一下例子与图解进行理解。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 变量对象</span>
<span class="token keyword">var</span> a2 <span class="token operator">=</span> <span class="token string">'this is str'</span><span class="token punctuation">;</span> <span class="token comment">// 变量对象</span>
<span class="token keyword">var</span> a3 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 变量对象</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">{</span>m<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 变量b存在变量对象中，{m: 20} 作为对象存放在堆内存中</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 变量c存在变量对象中，[1, 2, 3] 作为对象存放在堆内存中</span>
</code></pre></div><p><img src="/myBlog/assets/img/p1-3.212d2fce.png" alt="p2"></p> <p>因此当我们要访问堆内存中的引用数据类型时，实际上我们首先是从变量对象中获取了该对象的地址应用（或者地址指针），然后再从堆内存中取得我们需要的数据。</p> <p>在前端面试中我们常常会遇到这样一个类似的题目</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// demo01.js</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>
b <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

<span class="token comment">// 这时a的值是多少</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// demo02.js </span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> m<span class="token punctuation">;</span>
n<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>

<span class="token comment">// 这时m.a的值是多少</span>
</code></pre></div><p>在变量对象中的数据发生复制行为时，系统会自动为新的变量分配一个新值。复制之后，a和b虽然值都等于20，但是他们其实已经是相互独立互不影响的值了。</p> <p><img src="/myBlog/assets/img/p1-4.8c5f6216.png" alt="p4"></p> <p>在demo2中，我们通过<code>var n = m</code>执行一次复制引用类型的操作。应用类型的复制同样也会为新的变量自动 分配一个新的值保存在变量对象中，但不同的是，这个新的值，仅仅只是应用类型的一个地址指针。当地址指针相同时，尽管他们相互独立，但是在变量中访问到的具体对象实际上是同一个。如图所示</p> <p><img src="/myBlog/assets/img/p1-5.b268fd91.png" alt="p5"></p> <h4 id="六、内存空间管理"><a href="#六、内存空间管理" class="header-anchor">#</a> 六、内存空间管理</h4> <p>因为JavaScript具有自动垃圾收集机制，所以在开发时好像不用关心内存的使用问题，内存的分配与回收都全部实现了自动管理。但是根据我自己的开发经验，了解内存机制有助于自己清晰的认识到自己写的代码在执行过程中发生过什么，从而写出性能更加优秀的代码。</p> <p>JavaScript的内存生命周期</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token number">1.</span> 分配你所需的内存
<span class="token number">2.</span> 使用分配到的内存（读、写）
<span class="token number">3.</span> 不需要时将其释放、归还
</code></pre></div><p>为了便于理解，我们使用一个简单的例子来解释这个周期。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 在内存中给数值变量分配空间</span>
<span class="token function">alert</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用内存</span>
a <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 使用完毕之后，释放内存空间</span>

</code></pre></div><p>第一步和第二步我们都很好理解，JavaScript在定义变量时就完成了内存分配。第三步释放内存空间则是我们需要重点理解的一个点。</p> <p>JavaScript有自动垃圾收集机制，那么这个自动垃圾收集机制的原理是什么呢？其实很简单，就是找出那些不再继续使用的值，然后释放其占用的内存。垃圾收集器会每隔固定的时间段就执行一次释放操作。</p> <p>在JavaScript中，最常用的是通过<strong>标记清除</strong>的算法来找到哪些对象是不再继续使用的，因此<code>a = null</code>其实仅仅只是做了一个释放引用的操作，让 a 原本对应的值失去引用，脱离执行环境，这个值会在下一次垃圾收集器执行操作时被找到并释放。而在适当的时候解除引用，是为页面获得更好性能的一个重要方式。</p> <blockquote><p>在局部作用域中，当函数执行完毕，局部变量也就没有存在的必要了，因此垃圾收集器很容易做出判断并回收。但是全局变量什么时候需要自动释放内存空间则很难判断，因此在我们的开发中，需要尽量避免使用全局变量。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/myBlog/technical/base/base6.html" class="prev">ES6语法</a></span> <span class="next"><a href="/myBlog/technical/base/base2.html">作用域闭包</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/myBlog/assets/js/app.fe4596cb.js" defer></script><script src="/myBlog/assets/js/2.69ff1a9d.js" defer></script><script src="/myBlog/assets/js/3.d6642b46.js" defer></script>
  </body>
</html>
